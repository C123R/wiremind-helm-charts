NAME: pypi
LAST DEPLOYED: Tue Nov 24 15:21:02 2020
NAMESPACE: default
STATUS: pending-install
REVISION: 1
TEST SUITE: None
HOOKS:
MANIFEST:
---
# Source: pypi/templates/secret.yaml
apiVersion: v1
data:
  auth: OiQyYSQxMCRWdHZaTXpBU05IbGVKUC40c2JaNEl1MXh5NjExRi9neWs3TW5hakVrMFFYQmRSU2tybC5tZQ==
kind: Secret
metadata:
  name:  default-basic-auth-upload-htpasswd
---
# Source: pypi/templates/pvc.yaml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: pypi
  labels:
    app: pypi
    chart: "pypi-0.2.1"
    release: "pypi"
    heritage: "Helm"
spec:
  accessModes:
    - "ReadWriteOnce"
  resources:
    requests:
      storage: "1Gi"
---
# Source: pypi/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: pypi
  labels:
    app: pypi
    chart: pypi-0.2.1
    release: pypi
    heritage: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: pypi
    release: pypi
---
# Source: pypi/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pypi
  labels:
    app: pypi
    chart: pypi-0.2.1
    release: pypi
    heritage: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app: pypi
      release: pypi
  template:
    metadata:
      labels:
        app: pypi
        release: pypi
    spec:
      containers:
        - name: pypi
          image: "codekoala/pypi:1.2.1"
          imagePullPolicy: IfNotPresent
          env:
          - name: "PYPI_PASSWD_FILE"
            value: "/htpasswd/auth"
          - name: "PYPI_PORT"
            value: "80"
          ports:
            - name: http
              containerPort: 80
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
            failureThreshold: 3
            initialDelaySeconds: 30
            periodSeconds: 60
            successThreshold: 1
            timeoutSeconds: 10
          readinessProbe:
            httpGet:
              path: /
              port: http
            failureThreshold: 3
            initialDelaySeconds: 5
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 10
          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi
          volumeMounts:
          - name: data
            mountPath: /srv/pypi
          - name: htpasswd
            readOnly: true
            mountPath: "/htpasswd"
      volumes:
      - name: htpasswd
        secret:
          secretName: default-basic-auth-upload-htpasswd
      - name: data
        persistentVolumeClaim:
          claimName: pypi

NOTES:
Do not forget to setup your secret for basic auth (downloading):
  htpasswd -c my-htpasswd-file my-user
  kubectl create secret generic basic-auth-htpasswd --from-file=my-htpasswd-file --namespace default
Do not forget to setup your secret for basic auth (uploading):
  htpasswd -c my-htpasswd-file-upload my-user
Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app=pypi,release=pypi" -o jsonpath="{.items[0].metadata.name}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl port-forward $POD_NAME 8080:80
